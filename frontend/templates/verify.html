{% extends "base.html" %} {% block content %}
<style>
  /* --- Base Card Styles (Unchanged) --- */
  .card {
    max-width: 600px;
    margin: 40px auto;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 25px;
    font-family: Arial, sans-serif;
  }
  /* --- Dynamic Background Colors --- */
  .valid {
    background: #e8f5e9;
  }
  .expired {
    background: #fff8e1;
  }
  .notfound,
  .external_url {
    background: #ffebee;
  }
  /* NEW: Style for when public info is found */
  .public_info_found {
    background: #e3f2fd; /* A light blue to distinguish it */
  }

  /* --- Header and Status Styles --- */
  .header {
    text-align: center;
    margin-bottom: 20px;
  }
  .header h2 {
    margin: 0;
    font-size: 1.5em;
  }
  .status-icon {
    font-size: 2.5em; /* Larger icon for more impact */
    margin-bottom: 10px;
  }
  .subtle {
    font-size: 0.95em;
    color: #555;
  }

  /* --- Details Table (Unchanged) --- */
  .details-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    color: #333;
  }
  .details-table td {
    padding: 10px;
    border-bottom: 1px solid #eee;
  }

  /* --- General Styles (Unchanged) --- */
  .verified-on {
    margin-top: 20px;
    text-align: center;
    font-size: 0.9em;
    color: #777;
  }
  .btn-link {
    display: inline-block;
    background: #007bff;
    color: #fff;
    padding: 12px 25px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    margin-top: 15px;
    transition: background 0.2s;
  }
  .btn-link:hover {
    background: #0056b3;
  }
</style>

<div class="card {{ status }}">
  <div class="header">
    <img
      src="{{ url_for('static', filename='images/logo.png') }}"
      alt="MedGuard Logo"
      style="max-height: 60px; margin-bottom: 10px"
    />

    <!-- ================================= -->
    <!-- DYNAMIC CONTENT BASED ON STATUS -->
    <!-- ================================= -->

    {% if status == 'valid' %}
    <div class="status-icon" style="color: #2e7d32">‚úÖ</div>
    <h2 style="color: #2e7d32">Batch Verified by MedGuard</h2>
    <p class="subtle">
      This is an authentic drug registered in the MedGuard system.
    </p>
    {% elif status == 'expired' %}
    <div class="status-icon" style="color: #ff8f00">‚ö†Ô∏è</div>
    <h2 style="color: #ff8f00">Warning: Drug Expired</h2>
    <p class="subtle">
      This is a registered drug, but it has passed its expiry date. Do not use.
    </p>

    <!-- NEW: Logic block to display public information -->
    {% elif status == 'public_info_found' %}
    <div class="status-icon" style="color: #007bff">‚ÑπÔ∏è</div>
    <h2 style="color: #007bff">Public Information Found</h2>
    <p class="subtle" style="font-weight: bold">
      Disclaimer: This information is from a public database and has
      <u>not</u> been independently verified by MedGuard.
    </p>

    {% elif status == 'external_url' %}
    <div class="status-icon" style="color: #c62828">üåê</div>
    <h2 style="color: #c62828">External Website Link</h2>
    <p class="subtle">
      This QR code points to an external website. MedGuard cannot verify its
      authenticity. Proceed with caution.
    </p>
    {% else %} {# This handles 'notfound' and any other case #}
    <div class="status-icon" style="color: #c62828">‚ùå</div>
    <h2 style="color: #c62828">Not Found in Any System</h2>
    <p class="subtle">
      This code is not registered in the MedGuard system or any known public
      database. This drug may be counterfeit. Please report it.
    </p>
    {% endif %}
  </div>

  <!-- Show MedGuard-verified details -->
  {% if batch %}
  <table class="details-table">
    <tr>
      <td><strong>Drug Name:</strong></td>
      <td>{{ batch.drug_name }}</td>
    </tr>
    <tr>
      <td><strong>Batch Number:</strong></td>
      <td>{{ batch.batch_number }}</td>
    </tr>
    <tr>
      <td><strong>Manufacturer:</strong></td>
      <td>{{ batch.manufacturer }}</td>
    </tr>
    <tr>
      <td><strong>Expiry Date:</strong></td>
      <td>{{ batch.expiry_date }}</td>
    </tr>
  </table>
  {% endif %}

  <!-- NEW: Show public info details -->
  {% if public_data %}
  <table class="details-table">
    <tr>
      <td><strong>Drug Name:</strong></td>
      <td>{{ public_data.drug_name }}</td>
    </tr>
    <tr>
      <td><strong>Manufacturer:</strong></td>
      <td>{{ public_data.manufacturer }}</td>
    </tr>
    <tr>
      <td><strong>NAFDAC Status:</strong></td>
      <td>{{ public_data.status }}</td>
    </tr>
    <tr>
      <td><strong>Details:</strong></td>
      <td>{{ public_data.details }}</td>
    </tr>
  </table>
  {% endif %}

  <!-- Show the external URL if the code was a link -->
  {% if external_url %}
  <div style="text-align: center; word-wrap: break-word; color: #333">
    <p>The scanned code links to the following address:</p>
    <strong
      style="background: #eee; padding: 5px; border-radius: 4px; color: #000"
      >{{ external_url }}</strong
    >
    <br />
    <a
      href="{{ external_url }}"
      class="btn-link"
      target="_blank"
      rel="noopener noreferrer"
      >Proceed to Website</a
    >
  </div>
  {% endif %}

  <!-- Show the unrecognized content if it wasn't found -->
  {% if scanned_content %}
  <div style="text-align: center; word-wrap: break-word; color: #333">
    <p>The scanned QR code contained the following unrecognized data:</p>
    <strong
      style="background: #eee; padding: 5px; border-radius: 4px; color: #000"
      >{{ scanned_content }}</strong
    >
  </div>
  {% endif %}

  <div class="verified-on">Checked on {{ verified_on }}</div>

  <div style="text-align: center; margin-top: 30px">
    <a href="/" class="btn-link" style="background-color: #555"
      >Scan Another Code</a
    >
  </div>
</div>
{% endblock %}
