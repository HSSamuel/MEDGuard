{% extends "base.html" %} {% block content %}
<style>
  /* --- Base Card Styles (Unchanged) --- */
  .card {
    max-width: 600px;
    margin: 40px auto;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 25px;
    font-family: Arial, sans-serif;
  }
  /* --- Dynamic Background Colors --- */
  .valid {
    background: #e8f5e9;
  }
  .expired {
    background: #fff8e1;
  }
  .notfound,
  .external_url {
    background: #ffebee;
  }
  .public_info_found,
  .unregistered_product_code {
    background: #e3f2fd;
  }

  /* --- Header and Status Styles --- */
  .header {
    text-align: center;
    margin-bottom: 20px;
  }
  .header h2 {
    margin: 0;
    font-size: 1.5em;
  }
  .status-icon {
    font-size: 2.5em;
    margin-bottom: 10px;
  }
  .subtle {
    font-size: 0.95em;
    color: #555;
  }

  /* --- Details Table (Unchanged) --- */
  .details-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    color: #333;
  }
  .details-table td {
    padding: 10px;
    border-bottom: 1px solid #eee;
  }

  /* --- General Styles (Unchanged) --- */
  .verified-on {
    margin-top: 20px;
    text-align: center;
    font-size: 0.9em;
    color: #777;
  }
  .btn-link {
    display: inline-block;
    background: #007bff;
    color: #fff;
    padding: 12px 25px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    margin-top: 15px;
    transition: background 0.2s;
  }
  .btn-link:hover {
    background: #0056b3;
  }

  .next-steps {
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid #ddd;
    text-align: left;
    color: #333;
  }
  .next-steps h3 {
    text-align: center;
    margin-bottom: 15px;
    color: #0056b3;
  }
  .next-steps ul {
    padding-left: 20px;
    margin-bottom: 0;
  }
  .next-steps li {
    margin-bottom: 10px;
  }
</style>

<div class="card {{ status }}">
  <div class="header">
    <img
      src="{{ url_for('static', filename='images/logo.png') }}"
      alt="MedGuard Logo"
      style="max-height: 60px; margin-bottom: 10px"
    />

    {% if anomaly_warning %}
    <div
      style="
        background: #fff3cd;
        color: #856404;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #ffeeba;
        margin-bottom: 20px;
      "
    >
      <h3 style="margin-top: 0; color: #856404">üö® Security Alert</h3>
      <p style="margin-bottom: 0">{{ anomaly_warning }}</p>
    </div>
    {% endif %} {% if status == 'valid' %}
    <div class="status-icon" style="color: #2e7d32">‚úÖ</div>
    <h2 style="color: #2e7d32">Batch Verified by MedGuard</h2>
    <p class="subtle">
      This is an authentic drug registered in the MedGuard system.
    </p>
    {% elif status == 'expired' %}
    <div class="status-icon" style="color: #ff8f00">‚ö†Ô∏è</div>
    <h2 style="color: #ff8f00">Warning: Drug Expired</h2>
    <p class="subtle">
      This is a registered drug, but it has passed its expiry date. Do not use.
    </p>
    {% elif status == 'public_info_found' %}
    <div class="status-icon" style="color: #007bff">‚ÑπÔ∏è</div>
    <h2 style="color: #007bff">Public Information Found</h2>
    <p class="subtle" style="font-weight: bold">
      Disclaimer: This information is from a public database and has
      <u>not</u> been independently verified by MedGuard.
    </p>
    {% elif status == 'external_url' %}
    <div class="status-icon" style="color: #c62828">üåê</div>
    <h2 style="color: #c62828">External Website Link</h2>
    <p class="subtle">
      This QR/Barcode  points to an external website. MedGuard cannot verify its
      authenticity. Proceed with caution.
    </p>

    {% elif status == 'unregistered_product_code' %}
    <div class="status-icon" style="color: #007bff">‚ÑπÔ∏è</div>
    <h2 style="color: #007bff">Unregistered Product Code</h2>
    <p class="subtle">
      This appears to be a standard product code, not a MedGuard verification
      code. MedGuard cannot verify this item, but it has not been flagged as
      counterfeit.
    </p>

    {% else %} {# This handles 'notfound' and any other case #}
    <div class="status-icon" style="color: #c62828">‚ùå</div>
    <h2 style="color: #c62828">Not Found in MedGuard System</h2>
    <p class="subtle">
      This QR/Barcode  is not registered in the MedGuard system. This drug may be
      counterfeit. Please report it.
    </p>
    {% endif %}
  </div>

  {% if batch %}
  <table class="details-table">
    <tr>
      <td><strong>Drug Name:</strong></td>
      <td>{{ batch.drug_name }}</td>
    </tr>
    <tr>
      <td><strong>Batch Number:</strong></td>
      <td>{{ batch.batch_number }}</td>
    </tr>
    <tr>
      <td><strong>Manufacturer:</strong></td>
      <td>{{ batch.manufacturer }}</td>
    </tr>
    <tr>
      <td><strong>Expiry Date:</strong></td>
      <td>{{ batch.expiry_date }}</td>
    </tr>
  </table>
  {% endif %} {% if public_data %}
  <table class="details-table">
    <tr>
      <td><strong>Drug Name:</strong></td>
      <td>{{ public_data.drug_name }}</td>
    </tr>
    <tr>
      <td><strong>Manufacturer:</strong></td>
      <td>{{ public_data.manufacturer }}</td>
    </tr>
    <tr>
      <td><strong>NAFDAC Status:</strong></td>
      <td>{{ public_data.status }}</td>
    </tr>
    <tr>
      <td><strong>Details:</strong></td>
      <td>{{ public_data.details }}</td>
    </tr>
  </table>
  {% endif %} {% if external_url %}
  <div style="text-align: center; word-wrap: break-word; color: #333">
    <p>The scanned code links to the following address:</p>
    <strong
      style="background: #eee; padding: 5px; border-radius: 4px; color: #000"
      >{{ external_url }}</strong
    >
    <br />
    <a
      href="{{ external_url }}"
      class="btn-link"
      target="_blank"
      rel="noopener noreferrer"
      >Proceed to Website</a
    >
  </div>
  {% endif %} {% if scanned_content %}
  <div style="text-align: center; word-wrap: break-word; color: #333">
    <p>The scanned QR/Barcode contained the following unrecognized data:</p>
    <strong
      style="background: #eee; padding: 5px; border-radius: 4px; color: #000"
      >{{ scanned_content }}</strong
    >
  </div>
  {% endif %} {% if status == 'notfound' or status ==
  'unregistered_product_code' %}
  <div class="next-steps">
    <h3>What To Do Next</h3>
    <ul>
      <li>
        <strong>Cross-check with NAFDAC:</strong> You can search for the drug on
        the official NAFDAC Greenbook or use their Mobile Authentication Service
        (MAS) for certain products.
      </li>
      <li>
        <strong>Report to MedGuard:</strong> If you are suspicious, use the
        "Report Counterfeit" form on our main page to alert regulators through
        our system.
      </li>
      <li>
        <strong>Report Officially to NAFDAC:</strong> For a direct report to the
        authorities, you can contact NAFDAC's Pharmacovigilance department via
        email at <a href="mailto:nafdac@nafdac.gov.ng">nafdac@nafdac.gov.ng</a>.
      </li>
    </ul>
  </div>
  {% endif %}

  {% if status == 'valid' and batch %}
  <div class="next-steps">
      <h3>Experiencing a Side Effect?</h3>
      <p style="text-align: center;">Help keep our medicines safe by reporting any unexpected reactions. Your contribution is vital for public health.</p>
      <div style="text-align: center;">
          <a href="{{ url_for('adr_report_form', drug_id=batch.id) }}" class="btn-link" style="background-color: #ff8f00;">Report a Side Effect</a>
      </div>
  </div>
  {% endif %}

  <div class="verified-on">Checked on {{ verified_on }}</div>

  <div style="text-align: center; margin-top: 30px">
    <a href="/" class="btn-link" style="background-color: #555"
      >Scan Another Code</a
    >
  </div>
</div>
{% endblock %}