{% extends "base.html" %} {% block content %}
<div class="panel qr-panel">
  <h2>{{ _('📷 Scan QR / Barcode') }}</h2>
  <div id="qr-reader" class="qr-reader"></div>
  <div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
  <button id="start-scan" class="btn btn-yellow">
    {{ _('Start Camera') }}
  </button>
  
  <button id="stop-scan" class="btn btn-danger">{{ _('Stop') }}</button>
  
  <button id="scan-from-file-btn" class="btn btn-secondary">{{ _('Scan from Image') }}</button>
  <input type="file" id="qr-input-file" accept="image/*" style="display: none;">
  </div>
</div>

  <div class="panel qr-panel">
    <h2>{{ _('🔍 Or Verify by Batch Number') }}</h2>
    <form id="verify-form" class="inline-form" style="justify-content: center">
      <input
        id="verify-batch"
        name="batch_number"
        class="input"
        placeholder="{{ _('Enter batch number') }}"
        required
      />
      <button id="verify-btn" type="submit" class="btn btn-yellow">
        {{ _('Verify') }}
      </button>
    </form>
  </div>

  <div id="result"></div>

  <div class="panel report-panel">
    <div class="panel">
      <h2>{{ _('🚨 Report Counterfeit') }}</h2>
      <div class="inline-form" style="margin-bottom: 8px">
        <input
          id="report-drug"
          class="input"
          placeholder="{{ _('Drug name') }}"
        />
        <input
          id="report-batch"
          class="input"
          placeholder="{{ _('Batch number') }}"
          required
        />
        <input
          id="report-location"
          class="input"
          placeholder="{{ _('Location (optional)') }}"
        />
        <input type="hidden" id="report-latitude" name="latitude" />
        <input type="hidden" id="report-longitude" name="longitude" />
      </div>
      <textarea
        id="report-note"
        class="input"
        placeholder="{{ _('Note (optional)') }}"
        style="width: 100%; min-height: 80px; margin-bottom: 8px"
      ></textarea>
      <div class="report-actions">
        <input type="file" id="report-image" class="input" accept="image/*" />
        <button id="report-btn" class="btn btn-yellow">
          {{ _('Report') }}
        </button>
      </div>
    </div>
    {% endblock %} {% block scripts %}
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

    {% block js_translations %}
    <script>
      window.translations = {
        taglines: [
          "{{ _('Because your health deserves the truth.') }}",
          "{{ _('No more guessing — just scanning.') }}",
          "{{ _('Keeping counterfeit meds off the streets.') }}",
          "{{ _('Your pocket pharmacist.') }}",
        ],
        batchRequired: "{{ _('Batch number is required to report.') }}",
        errorSubmitting: "{{ _('Error submitting report.') }}",
        reportSuccess: "{{ _('Report submitted successfully') }}",
        cameraAccessFailed:
          "{{ _('Camera access failed. Please check permissions.') }}",
        enterBatchNumber: "{{ _('Please enter a batch number.') }}",
      };
    </script>
    {% endblock %}

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    {% endblock %}
  </div>
</div>
